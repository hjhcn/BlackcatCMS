<%@ page language="java" import="java.util.*" pageEncoding="UTF-8"%>
<%@ taglib prefix="s" uri="/struts-tags"%>
<%--
  ~ Copyright (c) 2014.
  ~ haojunhua
  --%>

<s:include value="common/head.jsp" />
<!DOCTYPE html>
<html>
<head>
<title>测试画字</title>
<!--[if IE]>
  <script type="text/javascript" src="excanvas.js"></script>
<![endif]-->
<script>
	var modes = {
		normal : 0,
		drawHanzi : 1,
		drawStroke : 2,
		editStroke : 3
	};
	var MODE = modes.normal;
	$.extend($.fn.validatebox.defaults.rules, {
		hanzi : {
			validator : function(value) {
				if (value.length == 1) {
					if (value.charCodeAt(0) > 255)
						return true;
				}
			},
			message : "请输入一个汉字"
		}
	});

	$(function() {
		var canvas = $("#hanzi")[0];
		var imageData;
		if (canvas.getContext) {
			var ctx = canvas.getContext("2d");
			var str = "0,125.8789,144.1406@3,126.1719,125.1953@3,125.6348,98.0957@3,124.3164,62.93945@3,123.0469,27.7832@3,121.582,9.570313@3,120.0195,8.251953@3,118.457,6.982422@3,117.8223,5.517578@3,118.0664,3.955078@3,118.3594,2.392578@3,119.9219,1.904297@3,122.7539,2.392578@3,125.6348,2.929688@3,128.3691,3.710938@3,130.957,4.736328@3,133.5938,5.810547@3,135.0098,6.982422@3,135.2539,8.251953@3,135.5469,9.570313@3,135.1563,11.13281@3,134.082,12.93945@3,133.0566,14.79492@3,133.0566,39.25781@3,134.082,86.37695@3,135.1563,133.5449@3,135.5469,161.6699@3,135.2539,170.752@3,135.0098,179.834@3,133.5938,186.7188@3,130.957,191.4063@3,128.3691,196.0938@3,126.0254,198.4375@3,123.9258,198.4375@3,121.875,198.4375@3,120.5566,196.6309@3,120.0195,192.9688@3,119.5313,189.3555@3,116.0156,185.5469@3,109.4727,181.6406@3,102.9785,177.7344@3,100,175.3906@3,100.4883,174.6094@3,101.0254,173.8281@3,103.7598,173.8281@3,108.6914,174.6094@3,113.6719,175.3906@3,117.1875,175.7813@3,119.2383,175.7813@3,121.3379,175.7813@3,122.9004,175.293@3,123.9258,174.2188@3,125,173.1934@3,125.6348,163.1836@131,125.8789,144.1406@;0,93.45703,57.03125@3,96.09375,66.99219@3,97.50977,74.41406@3,97.75391,79.3457@3,98.04688,84.32617@3,97.36328,86.91406@3,95.80078,87.1582@3,94.23828,87.45117@3,92.1875,83.78906@3,89.55078,76.2207@3,86.96289,68.70117@3,84.86328,63.62305@3,83.30078,60.98633@3,81.73828,58.39844@3,81.88477,56.68945@3,83.69141,55.9082@3,85.54688,55.12695@3,88.76953,55.51758@131,93.45703,57.03125@;0,158.6914,74.21875@3,163.1348,73.73047@3,166.6504,73.38867@3,169.2383,73.0957@3,171.875,72.85156@3,173.1445,71.82617@3,173.1445,69.9707@3,173.1445,68.16406@3,171.3379,67.23633@3,167.6758,67.23633@3,164.0625,67.23633@3,152.1973,68.70117@3,132.1289,71.5332@3,112.1094,74.41406@3,100,75.83008@3,95.80078,75.78125@1,95.80078,82.8125@3,116.6504,79.73633@3,131.25,77.68555@3,139.5508,76.61133@3,147.9004,75.58594@3,154.2969,74.80469@131,158.6914,74.21875@;0,195.8008,102.3438@3,200,101.8555@3,204.541,102.6855@3,209.4727,104.7363@3,214.4531,106.8359@3,216.8945,108.7891@3,216.8945,110.5957@3,216.8945,112.4512@3,209.2285,113.3301@3,193.8477,113.3301@3,178.5156,113.3301@3,164.9414,114.0137@3,153.2227,115.2832@3,141.5039,116.6016@3,129.7852,118.0176@3,118.0664,119.5801@3,106.3477,121.1426@3,95.55664,122.8516@3,85.64453,124.6582@3,75.78125,126.5137@3,70.01953,127.3926@3,68.45703,127.3926@3,66.89453,127.3926@3,64.30664,126.5137@3,60.64453,124.6582@3,57.03125,122.8516@3,55.07813,121.2891@3,54.78516,119.9707@3,54.54102,118.7012@3,56.88477,118.0176@3,61.81641,118.0176@3,66.79688,118.0176@3,82.03125,116.4551@3,107.5195,113.3301@3,133.0566,110.2051@3,153.125,107.7637@3,167.6758,105.9082@3,182.2754,104.1016@3,191.6504,102.9297@131,195.8008,102.3438@;0,181.7383,129.6875@3,181.7383,132.8613@3,179.9316,134.7168@3,176.2695,135.2051@3,172.6563,135.7422@3,168.75,135.9863@3,164.5508,135.9863@3,160.4004,135.9863@3,152.832,136.7676@3,141.8945,138.3301@3,130.957,139.8926@3,120.3125,141.3574@3,109.8633,142.627@3,99.46289,143.9453@3,93.21289,144.5801@3,91.11328,144.5801@3,89.0625,144.5801@3,86.57227,143.7988@3,83.69141,142.2363@3,80.85938,140.6738@3,79.39453,139.502@3,79.39453,138.7207@3,79.39453,137.9395@3,81.88477,137.5488@3,86.81641,137.5488@3,91.79688,137.5488@3,108.8379,135.498@3,137.9883,131.2988@3,167.1875,127.1484@3,181.7383,126.6113@131,181.7383,129.6875@;0,204.3945,24.21875@3,208.0566,25.83008@3,210.6445,27.53906@3,212.207,29.3457@3,213.7695,31.20117@3,214.1602,32.4707@3,213.3789,33.25195@3,212.5977,34.0332@3,203.9063,34.42383@3,187.207,34.42383@3,170.5566,34.42383@3,144.9219,36.52344@3,110.2539,40.67383@3,75.63477,44.87305@3,57.66602,46.92383@3,56.34766,46.92383@3,55.07813,46.92383@3,52.97852,45.89844@3,50.09766,43.79883@3,47.26563,41.74805@3,46.48438,40.2832@3,47.75391,39.50195@3,49.07227,38.7207@3,50.48828,38.33008@3,52.05078,38.33008@3,53.61328,38.33008@3,58.83789,38.08594@3,67.67578,37.54883@3,76.5625,37.06055@3,91.11328,35.5957@3,111.4258,33.25195@3,131.7383,30.9082@3,149.3164,28.56445@3,164.1602,26.2207@3,179.0039,23.87695@3,188.5254,22.60742@3,192.6758,22.31445@3,196.875,22.07031@3,200.7813,22.70508@131,204.3945,24.21875@;0,177.0508,49.21875@3,181.25,51.85547@3,183.3008,53.71094@3,183.3008,54.73633@3,183.3008,55.81055@3,182.1289,56.5918@3,179.7852,57.08008@3,177.4414,57.61719@3,173.6816,61.76758@3,168.457,69.53125@1,158.3008,69.53125@3,160.9375,64.35547@3,162.207,60.74219@3,162.207,58.64258@3,162.207,56.5918@3,161.5723,55.12695@3,160.2539,54.3457@3,158.9844,53.56445@3,155.1758,53.71094@3,148.9258,54.73633@3,142.6758,55.81055@3,122.9004,58.88672@3,89.55078,64.0625@1,89.55078,57.03125@3,95.3125,57.08008@3,99.85352,56.83594@3,103.2227,56.29883@3,106.6406,55.81055@3,117.1875,54.10156@3,134.8633,51.2207@3,152.5879,48.38867@3,162.207,46.5332@3,163.7695,45.75195@3,165.332,44.9707@3,166.8945,44.72656@3,168.457,44.9707@3,170.0195,45.26367@3,172.9004,46.67969@131,177.0508,49.21875@;0,171.9727,82.42188@3,173.8281,81.68945@3,175.4883,81.44531@3,177.0508,81.68945@3,178.6133,81.98242@3,181.1035,83.54492@3,184.4727,86.37695@3,187.8906,89.25781@3,189.5508,91.21094@3,189.5508,92.23633@3,189.5508,93.31055@3,188.6719,94.48242@3,186.8164,95.75195@3,185.0098,97.07031@3,183.5938,100.5859@3,182.5195,106.2988@3,181.4941,112.0605@3,179.3945,120.3613@3,176.2695,131.25@1,169.2383,131.25@3,171.875,108.3984@3,172.7539,96.14258@3,171.9727,94.58008@3,171.1914,93.01758@3,169.7754,92.13867@3,167.6758,91.8457@3,165.625,91.60156@3,160.791,92.13867@3,153.2227,93.4082@3,145.7031,94.72656@3,134.2285,96.67969@3,118.8477,99.26758@3,103.5156,101.9043@3,94.77539,103.1738@3,92.67578,103.1738@3,90.625,103.1738@3,88.52539,102.3926@3,86.42578,100.8301@3,84.375,99.26758@3,83.30078,98.0957@3,83.30078,97.31445@3,83.30078,96.5332@3,85.54688,96.04492@3,89.94141,95.75195@3,94.38477,95.50781@3,98.14453,95.11719@3,101.2695,94.58008@3,104.3945,94.0918@3,112.207,92.91992@3,124.707,91.06445@3,137.207,89.25781@3,147.7539,87.54883@3,156.3477,85.98633@3,164.9414,84.42383@3,170.166,83.25195@163,171.9727,82.42188@;";
			var strokeArray = str.split(";");

			//绘制轮廓
			ctx.beginPath();
			ctx.lineJoin = "round";

			for ( var i = 0; i < strokeArray.length; i++) {
				if (strokeArray[i] == "")
					break;
				var pointArray = strokeArray[i].split("@");
				$("#strokes")
						.append(
								"<li><canvas width='125' height='100'></canvas><div class='action'><a href='#'>编辑<br/>轨迹</a></div><div class='index'>"
										+ (i + 1) + "</div></li>");
				var strokeCTX = $("#strokes li canvas")[i].getContext("2d");
				var point = pointArray[0].split(",");
				ctx.moveTo(point[1] * 2, point[2] * 2);
				strokeCTX.moveTo(point[1] / 2, point[2] / 2);
				for ( var j = 1; j < pointArray.length; j++) {
					point = pointArray[j].split(",");
					ctx.lineTo(point[1] * 2, point[2] * 2);
					strokeCTX.lineTo(point[1] / 2, point[2] / 2);
				}
				strokeCTX.fill();
			}
			ctx.stroke();

			/*
			ctx.save();
			//绘制笔顺
			ctx.clip();
			ctx.beginPath();
			ctx.lineWidth = 30;
			ctx.lineCap = "round";
			ctx.moveTo(245, 0);
			ctx.lineTo(245, 100);
			ctx.stroke();

			ctx.restore();
			 */

			//绘制关键点
			ctx.beginPath();
			ctx.arc(89, 102, 7, 0, Math.PI * 2, true);
			ctx.arc(189, 102, 7, 0, Math.PI * 2, true);
			ctx.fill();
			ctx.font = "13px sans-serif";
			ctx.fillStyle = "rgb(255,255,255)";
			ctx.textAlign = "center";
			ctx.textBaseline = "middle";
			ctx.fillText("1", 89, 102);
			ctx.fillText("2", 189, 102);
		}

		function init() {

		}

		$("#strokes").sortable();
	});
</script>
<style>
#hanziDIV {
	border: dashed 1px black;
	padding: 50px 0px;
	width: 500px;
	height: 400px;
	margin: 0 auto;
}

#strokes {
	margin: 10px;
	padding: 0px;
}

#strokes li {
	width: 230px;
	height: 130px;
	border: solid 1px black;
	margin: 2px;
	background-color: white;
	position: relative;
	list-style: none;
}

#strokes canvas {
	border: dashed 1px black;
	position: absolute;
	top: 10px;
	left: 10px;
}

#strokes .index {
	position: absolute;
	left: 1px;
	bottom: 1px;
	opacity: 0.4;
	font: italic 16px arial, sans-serif;
}

#strokes .action {
	position: absolute;
	top: 45px;
	right: 20px;
}

#strokes .action a:link,#strokes .action a:visited {
	text-decoration: none;
	color: black;
}

#strokes .action a:hover {
	text-decoration: underline;
	color: black;
}
</style>
</head>
<body class="easyui-layout">
	<div region="west" split="true" style="width:280px;">
		<ul id="strokes">
		</ul>
	</div>
	<div region="center" split="true" style="text-align: center;padding-top: 10px;">
		<div id="hanziDIV">
			<canvas id="hanzi" width="500" height="400"></canvas>
		</div>
	</div>
	<div region="east" split="true" style="width:200px;text-align: center;padding: 20px;">
		<a href="javascript:drawStroke()" class="easyui-linkbutton" iconCls="icon-do">演示轨迹</a><br /> <br />
		<a href="javascript:clearLocus()" class="easyui-linkbutton" iconCls="icon-cancel">清空轨迹</a><br />
		<br /> <a href="javascript:drawHanzi()" class="easyui-linkbutton" iconCls="icon-ok">演示全字</a><br />
		<br /> <a href="javascript:save()" class="easyui-linkbutton" iconCls="icon-save">保存数据</a>
	</div>

</body>
</html>
